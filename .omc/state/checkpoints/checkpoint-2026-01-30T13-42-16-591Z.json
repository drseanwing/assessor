{
  "created_at": "2026-01-30T13:42:16.590Z",
  "trigger": "auto",
  "active_modes": {
    "ultrawork": {
      "original_prompt": "<ide_opened_file>The user opened the file c:\\Users\\SeanWing\\Documents\\GitHub\\assessor\\.git\\COMMIT_EDITMSG in the IDE. This may or may not be related to the current task.</ide_opened_file>\nHere is a to-do list from a comprehensive program review.\n\nralph ulw\n\nWork through the list in priority order. Identify causes. Identify all areas of repo affected by issue. Consider most reliable fix in the context of this repo's architecture. Implement fix. Validate. Update documentation. Commit. Iterate to next task.\n\n\nCRIT-1: Move PIN auth server-side (bcrypt comparison in worker /api/login endpoint, stop exposing pin_hash to browser)\n\nCRIT-2: Fix WebSocket auth (frontend must pass JWT token in connection URL)\n\nCRIT-3: Add missing overall outcome UI (team_leader_outcome, team_member_outcome, recommended_action selectors)\n\nCRIT-4: Use separate DB passwords per PostgreSQL role (authenticator, redi_worker, redi_admin)\n\nCRIT-5: Gate dev mode banner behind import.meta.env.DEV\n\nCRIT-6: Add privacy/data protection notice (login page, email footer, healthcare data handling)\n\nCRIT-7: Rewrite DEPLOYMENT.md for Docker stack (currently describes Supabase)\n\nCRIT-8: Fill in CLAUDE.md template with actual project details\n\nCRIT-9: Fix PG LISTEN connection leak on reconnect (call client.end(), prevent double reconnect)\n\nCRIT-10: Remove hardcoded JWT fallback from docker-compose.yml, make SUPABASE_ANON_KEY required\n\nCRIT-A11Y: Make course cards and participant rows keyboard-operable (button/link, tabIndex, onKeyDown)\n\nCRIT-A11Y: Bondy scale must not rely solely on color (add patterns/text, fix lime/yellow contrast)\n\nCRIT-A11Y: Add aria-live regions to loading spinners, save/sync status indicators\n\nHIGH-1: Fix N+1 queries in AssessmentPage and assessmentStore (batch with .in() like CourseDashboardPage)\n\nHIGH-2: Fix saveChanges race condition (add save-in-progress guard, cancel debounce on reset)\n\nHIGH-3: Fix useRealtime infinite reconnect (memoize participantIds array at AssessmentPage call site)\n\nHIGH-4: Surface data fetch errors to UI with retry button (assessmentStore, CourseDashboardPage)\n\nHIGH-5: Fix React Fragment key in DashboardGrid (use React.Fragment key=)\n\nHIGH-6: Add route-level code splitting with React.lazy + Suspense\n\nHIGH-7: Make RLS policies meaningful (use JWT claims to scope access, not USING(true))\n\nHIGH-8: Remove DELETE grant from web_anon on assessment tables\n\nHIGH-9: Extract and propagate JWT claims in auth middleware (store on req.user)\n\nHIGH-10: Add timeouts to external REdI API calls (AbortController, 30s)\n\nHIGH-11: Add sync concurrency guard (reject if already running)\n\nHIGH-12: Configure DB pool explicitly (max, idleTimeout, connectionTimeout, statementTimeout)\n\nHIGH-13: Fix graceful shutdown (close WebSocket server, PG listener client)\n\nHIGH-14: Validate WebSocket message inputs (type check courseId, participantIds, assessorId)\n\nHIGH-15: Add exponential backoff to PG listener reconnect (replace fixed 5s)\n\nHIGH-16: Add stale WebSocket presence cleanup (periodic sweep on lastSeen)\n\nHIGH-17: Configure HTTPS/TLS in nginx (or document as known gap for dev)\n\nHIGH-18: Add nginx rate limiting on /rest/v1/ (limit_req)\n\nHIGH-19: Add container resource limits in docker-compose.yml\n\nHIGH-20: Fix report terminology 'Stations' -> 'Components', 'candidate_name' -> 'participant'\n\nHIGH-21: Add REdI branding to email template (logo, brand colors, subject prefix)\n\nHIGH-A11Y: Add skip-nav link, ARIA tab pattern on ComponentTabs, aria-labels on buttons\n\nHIGH-A11Y: Associate error messages with inputs (role=alert, aria-describedby), add required attrs\n\nHIGH-A11Y: Add labels to search input, filter/sort selects, FeedbackInput textarea\n\nMED-1: Fix engagementScore falsy check (use ?? instead of ||)\n\nMED-2: Consolidate duplicated type definitions into src/types/\n\nMED-3: Fix formatRole to use replaceAll, add title-casing for UI display\n\nMED-4: Add Supabase client startup guard (defer error to render time)\n\nMED-5: Clean up dead Supabase auth/realtime config in supabase.ts\n\nMED-6: Add updated_at triggers to template_components and template_outcomes\n\nMED-7: Validate cron expressions at startup (cron.validate before schedule)\n\nMED-8: Add report directory creation at startup (mkdir recursive)\n\nMED-9: HTML-escape report content before markdown-to-HTML conversion (prevent stored XSS)\n\nMED-10: Specify JWT algorithm in verify calls ({ algorithms: ['HS256'] })\n\nMED-11: Add server_tokens off to nginx config\n\nMED-12: Document env vars SYNC_CRON, REPORT_CRON, REPORT_DIR, CORS_ORIGIN in .env.docker.example\n\nMED-13: Reconcile offline support status across README and USER_GUIDE\n\nMED-14: Fix 'Not Obs' truncation to 'Not Observed' in Bondy legend\n\nMED-A11Y: Add aria-hidden to decorative SVGs, wrap emoji in aria-hidden spans\n\nMED-A11Y: Add main landmark to LoginPage, OfflineIndicator role=alert\n\nLOW-1: Introduce structured logging (pino) to replace console.log/error\n\nLOW-2: Add CHECK constraint for bondy_score/binary_score mutual exclusivity\n\nLOW-3: Add UNIQUE constraint on assessors.email (partial, WHERE NOT NULL)\n\nLOW-4: Create worker/.dockerignore\n\nLOW-5: Make DB init role creation idempotent (IF NOT EXISTS)\n\nLOW-6: Add automated DB backup strategy (cron pg_dump)\n\nLOW-7: Update PostgREST Alpine base from 3.19 to 3.21\n\nLOW-8: Remove source maps from worker production image\n\nLOW-9: Add docker-compose project name (name: redi-assessment)\n\nLOW-10: Update README project structure, fix test commands, fix outcome count (29 not 27)\n\nLOW-11: Add worker API reference docs (all endpoints, methods, auth requirements)\n\nLOW-A11Y: Fix lime/yellow-on-white contrast in BondySelector, increase touch targets to 48px"
    }
  },
  "todo_summary": {
    "pending": 0,
    "in_progress": 0,
    "completed": 0
  },
  "wisdom_exported": false
}