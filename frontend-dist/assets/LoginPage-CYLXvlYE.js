import{u as N,a as k,r as n,j as e}from"./index-C-rJlfSu.js";async function A(t){try{const r=await fetch("/worker/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({assessorId:t.assessorId,pin:t.pin})}),o=await r.json();return!r.ok||!o.success?{success:!1,error:o.error||"Login failed"}:{success:!0,assessor:o.assessor,token:o.token}}catch(r){return console.error("Login error:",r),{success:!1,error:"Login failed. Please try again."}}}async function S(){try{const t=await fetch("/worker/api/auth/assessors"),r=await t.json();return t.ok?r.assessors||[]:[]}catch(t){return console.error("Error fetching assessors:",t),[]}}function P(){const t=N(),{setAssessor:r,setToken:o,setSessionExpiry:y,isAuthenticated:h}=k(),[u,b]=n.useState([]),[l,g]=n.useState(""),[c,m]=n.useState(""),[d,x]=n.useState(!1),[p,i]=n.useState(""),f=n.useCallback(async()=>{const s=await S();b(s),s.length>0&&g(s[0].assessor_id)},[]);n.useEffect(()=>{h()&&t("/courses"),f()},[h,t,f]);const j=s=>{const a=s.replace(/\D/g,"").slice(0,4);m(a),i("")},v=async s=>{if(s.preventDefault(),!l){i("Please select an assessor");return}if(c.length!==4){i("PIN must be 4 digits");return}x(!0),i("");const a=await A({assessorId:l,pin:c});if(a.success&&a.assessor&&a.token){const w=Date.now()+432e5;r(a.assessor),o(a.token),y(w),t("/courses")}else i(a.error||"Login failed"),m("");x(!1)};return e.jsx("main",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-redi-light-teal/20 to-redi-navy/10 px-4",children:e.jsxs("div",{className:"max-w-md w-full",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h1",{className:"text-5xl font-display text-redi-navy mb-2 tracking-wide",children:"REdI Assess"}),e.jsx("p",{className:"text-redi-navy/70",children:"Competency Assessment System"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-xl p-8",children:[e.jsx("h2",{className:"text-2xl font-semibold text-redi-navy mb-6",children:"Assessor Login"}),e.jsxs("form",{onSubmit:v,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"assessor",className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Assessor"}),e.jsx("select",{id:"assessor",value:l,onChange:s=>g(s.target.value),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-redi-teal focus:border-transparent",disabled:d||u.length===0,children:u.length===0?e.jsx("option",{value:"",children:"Loading assessors..."}):u.map(s=>e.jsx("option",{value:s.assessor_id,children:s.name},s.assessor_id))})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"pin",className:"block text-sm font-medium text-gray-700 mb-2",children:"4-Digit PIN"}),e.jsx("input",{id:"pin",type:"password",inputMode:"numeric",value:c,onChange:s=>j(s.target.value),placeholder:"••••",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-redi-teal focus:border-transparent text-center text-2xl tracking-widest",disabled:d,maxLength:4,autoComplete:"off"})]}),p&&e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg text-sm",children:p}),e.jsx("button",{type:"submit",disabled:d||!l||c.length!==4,className:"w-full bg-redi-coral hover:bg-redi-coral-dark disabled:bg-gray-400 disabled:cursor-not-allowed text-white font-semibold py-3 px-4 rounded-lg transition-colors duration-200",children:d?"Logging in...":"Login"})]}),!1]}),e.jsx("div",{className:"mt-4 px-2",children:e.jsxs("p",{className:"text-xs text-redi-navy/50 leading-relaxed",children:["This system processes personal and health-related education data in accordance with the ",e.jsx("em",{children:"Information Privacy Act 2009"})," (Qld) and Queensland Health information security policies. Data entered is used solely for competency assessment purposes and is stored securely within Queensland Health infrastructure. By logging in, you acknowledge your responsibility to handle participant data in accordance with Queensland Health privacy obligations."]})}),e.jsx("div",{className:"text-center mt-6 text-sm text-redi-navy/60",children:e.jsx("p",{children:"Queensland Health - Resuscitation Education Initiative"})})]})})}export{P as default};
