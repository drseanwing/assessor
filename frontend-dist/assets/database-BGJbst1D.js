import{j as e,r}from"./index-C-rJlfSu.js";function T({status:c}){const a=()=>{switch(c){case"connected":return e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"relative flex h-2 w-2",children:[e.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"}),e.jsx("span",{className:"relative inline-flex rounded-full h-2 w-2 bg-green-500"})]}),e.jsx("span",{className:"text-green-600 text-xs font-medium",children:"Live"})]});case"connecting":return e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"relative flex h-2 w-2",children:e.jsx("span",{className:"animate-pulse inline-flex rounded-full h-2 w-2 bg-yellow-500"})}),e.jsx("span",{className:"text-yellow-600 text-xs font-medium",children:"Connecting..."})]});case"reconnecting":return e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"relative flex h-2 w-2",children:e.jsx("span",{className:"animate-pulse inline-flex rounded-full h-2 w-2 bg-orange-500"})}),e.jsx("span",{className:"text-orange-600 text-xs font-medium",children:"Reconnecting..."})]});case"disconnected":return e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"relative flex h-2 w-2",children:e.jsx("span",{className:"inline-flex rounded-full h-2 w-2 bg-red-500"})}),e.jsx("span",{className:"text-red-600 text-xs font-medium",children:"Offline"})]});default:return null}};return e.jsx("div",{className:"flex items-center space-x-1.5",role:"status","aria-live":"polite",title:`Connection status: ${c}`,children:a()})}function w(){try{const c=localStorage.getItem("redi-auth-storage");if(c)return JSON.parse(c).state?.assessor}catch{}return null}function _({participantIds:c=[],courseId:a,onAssessmentChange:v,onScoreChange:y,onPresenceChange:j}={}){const[I,g]=r.useState("connecting"),[x,E]=r.useState([]),d=r.useRef(null),h=r.useRef(null),f=r.useRef(null),S=r.useRef({participantId:"",componentId:null}),N=r.useRef(0),p=r.useRef({onAssessmentChange:v,onScoreChange:y,onPresenceChange:j});r.useEffect(()=>{p.current={onAssessmentChange:v,onScoreChange:y,onPresenceChange:j}}),r.useEffect(()=>{if(!a)return;const i=()=>{let o=null;try{const t=localStorage.getItem("redi-auth-storage");t&&(o=JSON.parse(t).state?.token||null)}catch{}const u=window.location.protocol==="https:"?"wss:":"ws:",b=o?`${u}//${window.location.host}/ws?token=${encodeURIComponent(o)}`:`${u}//${window.location.host}/ws`,s=new WebSocket(b);s.onopen=()=>{g("connected"),N.current=0,s.send(JSON.stringify({type:"subscribe",courseId:a,participantIds:c}));const t=w();if(t){const n=()=>{s.readyState===WebSocket.OPEN&&s.send(JSON.stringify({type:"presence",courseId:a,assessorId:t.assessor_id,assessorName:t.name,participantId:S.current.participantId,componentId:S.current.componentId}))};n(),f.current=setInterval(n,15e3)}},s.onmessage=t=>{try{const n=JSON.parse(t.data);if(n.type==="change"){const l={eventType:n.action,new:n.record||{},old:n.old_record||{}};n.table==="component_assessments"?p.current.onAssessmentChange?.(l):n.table==="outcome_scores"&&p.current.onScoreChange?.(l)}else if(n.type==="presence_state"&&(E(n.assessors||[]),p.current.onPresenceChange)){const l={};for(const m of n.assessors||[])l[m.assessorId]||(l[m.assessorId]=[]),l[m.assessorId].push(m);p.current.onPresenceChange(l)}}catch{}},s.onclose=()=>{g("reconnecting"),f.current&&clearInterval(f.current);const t=Math.min(1e3*Math.pow(2,N.current),3e4);N.current++,h.current=setTimeout(i,t)},s.onerror=()=>{s.close()},d.current=s};return g("connecting"),i(),()=>{d.current&&(d.current.close(),d.current=null),h.current&&clearTimeout(h.current),f.current&&clearInterval(f.current)}},[a,c]);const R=r.useCallback((i,o)=>{if(S.current={participantId:i,componentId:o},d.current?.readyState===WebSocket.OPEN){const u=w();u&&d.current.send(JSON.stringify({type:"presence",courseId:a,assessorId:u.assessor_id,assessorName:u.name,participantId:i,componentId:o}))}},[a]),O=r.useCallback((i,o)=>{const b=w()?.assessor_id;return x.some(s=>{if(s.assessorId===b||s.participantId!==i||o&&s.componentId!==o)return!1;const t=new Date(s.lastSeen);return(new Date().getTime()-t.getTime())/1e3<30})},[x]);return{connectionStatus:I,activeAssessors:x,trackPresence:R,isOtherAssessorEditing:O}}const k=[{value:5,score:"INDEPENDENT",label:"Independent",shortLabel:"I",color:"green",description:"Safe, accurate, and proficient; no supporting cues required"},{value:4,score:"SUPERVISED",label:"Supervised",shortLabel:"S",color:"light-green",description:"Safe, accurate; occasional supportive cues required"},{value:3,score:"ASSISTED",label:"Assisted",shortLabel:"A",color:"yellow",description:"Safe but requires frequent verbal/physical directive cues"},{value:2,score:"MARGINAL",label:"Marginal/Dependent",shortLabel:"M",color:"orange",description:"Unsafe; continuous verbal/physical cues required"},{value:1,score:"NOT_OBSERVED",label:"Not Observed",shortLabel:"N",color:"gray",description:"Not demonstrated/observed during assessment"}],D=[{value:5,emoji:"ðŸ˜",label:"Excellent engagement"},{value:4,emoji:"ðŸ™‚",label:"Good engagement"},{value:3,emoji:"ðŸ˜",label:"Adequate engagement"},{value:2,emoji:"ðŸ™",label:"Poor engagement"},{value:1,emoji:"ðŸ˜ž",label:"Very poor engagement"}];export{k as B,D as E,T as S,_ as u};
