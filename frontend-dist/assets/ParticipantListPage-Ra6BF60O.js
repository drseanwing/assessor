import{b as L,a as E,u as M,r as a,j as e}from"./index-C-rJlfSu.js";import{s as y}from"./supabase-CEO_BhdU.js";function A(){const{courseId:n}=L(),{assessor:f}=E(),x=M(),[j,N]=a.useState(null),[c,w]=a.useState([]),[o,l]=a.useState([]),[v,m]=a.useState(!0),[p,h]=a.useState(""),[r,b]=a.useState(""),u=a.useCallback(async()=>{m(!0),h("");try{const{data:s,error:t}=await y.from("courses").select("*").eq("course_id",n).single();if(t)throw t;N(s);const{data:i,error:g}=await y.from("participants").select("*").eq("course_id",n).order("candidate_name",{ascending:!0});if(g)throw g;w(i||[]),l(i||[])}catch(s){console.error("Error loading course data:",s),h("Failed to load participants. Please try again.")}finally{m(!1)}},[n]);a.useEffect(()=>{n&&u()},[n,u]),a.useEffect(()=>{if(r.trim()==="")l(c);else{const s=r.toLowerCase(),t=c.filter(i=>i.candidate_name.toLowerCase().includes(s)||i.payroll_number?.toLowerCase().includes(s)||i.designation?.toLowerCase().includes(s)||i.work_area?.toLowerCase().includes(s));l(t)}},[r,c]);const d=s=>{x(`/course/${n}/participant/${s}/assess`)},k=()=>{x("/courses")},C=s=>{switch(s){case"TEAM_LEADER":return"bg-redi-navy/10 text-redi-navy";case"TEAM_MEMBER":return"bg-redi-teal/10 text-redi-teal";case"BOTH":return"bg-redi-sky/10 text-redi-sky";default:return"bg-gray-100 text-gray-800"}},_=s=>s.split("_").map(t=>t.charAt(0)+t.slice(1).toLowerCase()).join(" ");return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("header",{className:"bg-white shadow-sm border-b-2 border-redi-coral",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("button",{onClick:k,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx("svg",{className:"h-6 w-6 text-gray-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-redi-navy",children:j?.course_name||"Course Participants"}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Assessor: ",f?.name]})]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("p",{className:"text-sm text-gray-600",children:[o.length," of ",c.length," participant",c.length!==1?"s":""]})})]})})}),e.jsxs("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"relative",children:[e.jsx("label",{htmlFor:"participant-search",className:"sr-only",children:"Search participants"}),e.jsx("input",{id:"participant-search",type:"text",placeholder:"Search by name, payroll, designation, or work area...",value:r,onChange:s=>b(s.target.value),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-redi-teal focus:border-transparent"}),e.jsx("div",{className:"absolute left-3 top-3.5",children:e.jsx("svg",{className:"h-5 w-5 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})})]})}),p&&e.jsx("div",{className:"mb-6 bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg",children:p}),v?e.jsx("div",{className:"flex justify-center items-center py-12",role:"status","aria-label":"Loading",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-redi-teal","aria-hidden":"true"})}):o.length===0?e.jsxs("div",{className:"bg-white rounded-lg shadow p-8 text-center",children:[e.jsx("div",{className:"text-gray-400 mb-4",children:e.jsx("svg",{className:"mx-auto h-12 w-12",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:r?"No matching participants":"No participants"}),e.jsx("p",{className:"text-gray-600",children:r?`No participants match "${r}"`:"No participants enrolled in this course yet"})]}):e.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Name"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Payroll"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Designation"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Work Area"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Role"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Action"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:o.map(s=>e.jsxs("tr",{tabIndex:0,className:"hover:bg-gray-50 cursor-pointer focus:outline-none focus:bg-redi-teal/5 focus:ring-2 focus:ring-inset focus:ring-redi-teal",onClick:()=>d(s.participant_id),onKeyDown:t=>{(t.key==="Enter"||t.key===" ")&&(t.preventDefault(),d(s.participant_id))},children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:s.candidate_name})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-600",children:s.payroll_number||"-"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-600",children:s.designation||"-"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-600",children:s.work_area||"-"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full ${C(s.assessment_role)}`,children:_(s.assessment_role)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:e.jsx("button",{className:"text-redi-coral hover:text-redi-coral-dark font-medium",onClick:t=>{t.stopPropagation(),d(s.participant_id)},children:"Assess â†’"})})]},s.participant_id))})]})})})]})]})}export{A as default};
