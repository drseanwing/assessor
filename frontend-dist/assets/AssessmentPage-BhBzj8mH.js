import{j as e,c as ne,r as f,b as ae,a as oe,u as ie}from"./index-C-rJlfSu.js";import{s as b}from"./supabase-CEO_BhdU.js";import{B as ce,E as le,u as de,S as P}from"./database-BGJbst1D.js";function me({assessors:t,currentParticipantId:i,currentComponentId:s}){const n=t.filter(o=>{if(i&&o.participantId!==i||s&&o.componentId&&o.componentId!==s)return!1;const u=new Date(o.lastSeen);return(new Date().getTime()-u.getTime())/1e3<30});if(n.length===0)return null;const a=[...new Set(n.map(o=>o.assessorName))];return e.jsxs("div",{className:"flex items-center space-x-1.5 px-2 py-1 bg-redi-navy/10 rounded-full text-xs text-redi-navy",title:`Also editing: ${a.join(", ")}`,children:[e.jsx("svg",{className:"w-3 h-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})}),e.jsx("span",{children:a.length===1?a[0]:`${a.length} others`})]})}const I={participant:null,components:[],outcomes:{},componentAssessments:{},overallAssessment:{overallId:null,feedback:"",engagementScore:null,teamLeaderOutcome:null,teamMemberOutcome:null,recommendedAction:null,isDirty:!1},activeComponentId:null,saveStatus:"idle",lastSaved:null},ue=ne((t,i)=>({...I,setParticipant:s=>t({participant:s}),setComponents:s=>{t({components:s}),s.length>0&&!i().activeComponentId&&t({activeComponentId:s[0].component_id})},setOutcomes:(s,n)=>{t(a=>({outcomes:{...a.outcomes,[s]:n}}))},setActiveComponent:s=>t({activeComponentId:s}),loadAssessments:async()=>{const{participant:s,components:n}=i();if(s)try{const{data:a}=await b.from("component_assessments").select("*").eq("participant_id",s.participant_id),o=(a||[]).map(l=>l.assessment_id);let u=[];if(o.length>0){const{data:l}=await b.from("outcome_scores").select("*").in("assessment_id",o);u=l||[]}const r=new Map;for(const l of u){const g=r.get(l.assessment_id)||[];g.push(l),r.set(l.assessment_id,g)}const c={};for(const l of n){const g=a?.find(x=>x.component_id===l.component_id),p={};if(g){const x=r.get(g.assessment_id)||[];for(const h of x)p[h.outcome_id]={outcomeId:h.outcome_id,bondyScore:h.bondy_score,binaryScore:h.binary_score,isDirty:!1}}c[l.component_id]={componentId:l.component_id,assessmentId:g?.assessment_id||null,feedback:g?.component_feedback||"",isQuickPassed:g?.is_passed_quick||!1,isDirty:!1,scores:p}}const{data:d}=await b.from("overall_assessments").select("*").eq("participant_id",s.participant_id).maybeSingle();t({componentAssessments:c,overallAssessment:{overallId:d?.overall_id??null,feedback:d?.overall_feedback??"",engagementScore:d?.engagement_score??null,teamLeaderOutcome:d?.team_leader_outcome??null,teamMemberOutcome:d?.team_member_outcome??null,recommendedAction:d?.recommended_action??null,isDirty:!1}})}catch(a){console.error("Error loading assessments:",a),t({saveStatus:"error"})}},setBondyScore:(s,n,a)=>{t(o=>{const u=o.componentAssessments[s]||{componentId:s,assessmentId:null,feedback:"",isQuickPassed:!1,isDirty:!0,scores:{}};return{componentAssessments:{...o.componentAssessments,[s]:{...u,isDirty:!0,isQuickPassed:!1,scores:{...u.scores,[n]:{outcomeId:n,bondyScore:a,binaryScore:null,isDirty:!0}}}}}}),i().saveChanges()},setBinaryScore:(s,n,a)=>{t(o=>{const u=o.componentAssessments[s]||{componentId:s,assessmentId:null,feedback:"",isQuickPassed:!1,isDirty:!0,scores:{}};return{componentAssessments:{...o.componentAssessments,[s]:{...u,isDirty:!0,scores:{...u.scores,[n]:{outcomeId:n,bondyScore:null,binaryScore:a,isDirty:!0}}}}}}),i().saveChanges()},applyQuickPass:s=>{const{outcomes:n,participant:a}=i(),o=n[s]||[];t(u=>{const r=u.componentAssessments[s]||{componentId:s,assessmentId:null,feedback:"",isQuickPassed:!1,isDirty:!0,scores:{}},c={...r.scores};for(const d of o){const l=d.applies_to==="BOTH"||d.applies_to===a?.assessment_role||a?.assessment_role==="BOTH";d.is_mandatory&&l&&d.outcome_type==="BONDY_SCALE"&&(c[d.outcome_id]={outcomeId:d.outcome_id,bondyScore:"INDEPENDENT",binaryScore:null,isDirty:!0})}return{componentAssessments:{...u.componentAssessments,[s]:{...r,isQuickPassed:!0,isDirty:!0,scores:c}}}}),i().saveChanges()},setComponentFeedback:(s,n)=>{t(a=>{const o=a.componentAssessments[s]||{componentId:s,assessmentId:null,feedback:"",isQuickPassed:!1,isDirty:!0,scores:{}};return{componentAssessments:{...a.componentAssessments,[s]:{...o,feedback:n,isDirty:!0}}}}),i().saveChanges()},setOverallFeedback:s=>{t(n=>({overallAssessment:{...n.overallAssessment,feedback:s,isDirty:!0}})),i().saveChanges()},setEngagementScore:s=>{t(n=>({overallAssessment:{...n.overallAssessment,engagementScore:s,isDirty:!0}})),i().saveChanges()},setTeamLeaderOutcome:s=>{t(n=>({overallAssessment:{...n.overallAssessment,teamLeaderOutcome:s,isDirty:!0}})),i().saveChanges()},setTeamMemberOutcome:s=>{t(n=>({overallAssessment:{...n.overallAssessment,teamMemberOutcome:s,isDirty:!0}})),i().saveChanges()},setRecommendedAction:s=>{t(n=>({overallAssessment:{...n.overallAssessment,recommendedAction:s,isDirty:!0}})),i().saveChanges()},saveChanges:(()=>{let s=null,n=!1;const a=()=>{try{const o=localStorage.getItem("redi-auth-storage");if(o)return JSON.parse(o).state?.assessor?.assessor_id||null}catch{}return null};return async()=>{s&&clearTimeout(s),s=setTimeout(async()=>{if(n)return;const{participant:o,componentAssessments:u,overallAssessment:r}=i();if(!o)return;const c=a();n=!0,t({saveStatus:"saving"});try{for(const[d,l]of Object.entries(u)){if(!l.isDirty)continue;let g=l.assessmentId;if(g){const{error:p}=await b.from("component_assessments").update({component_feedback:l.feedback,is_passed_quick:l.isQuickPassed,last_modified_by:c,last_modified_at:new Date().toISOString()}).eq("assessment_id",g);if(p)throw p}else{const{data:p,error:x}=await b.from("component_assessments").insert({participant_id:o.participant_id,component_id:d,component_feedback:l.feedback,is_passed_quick:l.isQuickPassed,last_modified_by:c}).select().single();if(x)throw x;g=p.assessment_id,t(h=>({componentAssessments:{...h.componentAssessments,[d]:{...h.componentAssessments[d],assessmentId:g}}}))}for(const[p,x]of Object.entries(l.scores)){if(!x.isDirty)continue;const{error:h}=await b.from("outcome_scores").upsert({assessment_id:g,outcome_id:p,bondy_score:x.bondyScore,binary_score:x.binaryScore,scored_by:c,scored_at:new Date().toISOString()},{onConflict:"assessment_id,outcome_id"});if(h)throw h}t(p=>({componentAssessments:{...p.componentAssessments,[d]:{...p.componentAssessments[d],isDirty:!1,scores:Object.fromEntries(Object.entries(p.componentAssessments[d].scores).map(([x,h])=>[x,{...h,isDirty:!1}]))}}}))}if(r.isDirty)if(r.overallId){const{error:d}=await b.from("overall_assessments").update({overall_feedback:r.feedback,engagement_score:r.engagementScore,team_leader_outcome:r.teamLeaderOutcome,team_member_outcome:r.teamMemberOutcome,recommended_action:r.recommendedAction,last_modified_by:c,last_modified_at:new Date().toISOString()}).eq("overall_id",r.overallId);if(d)throw d;t(l=>({overallAssessment:{...l.overallAssessment,isDirty:!1}}))}else{const{data:d,error:l}=await b.from("overall_assessments").insert({participant_id:o.participant_id,overall_feedback:r.feedback,engagement_score:r.engagementScore,team_leader_outcome:r.teamLeaderOutcome,team_member_outcome:r.teamMemberOutcome,recommended_action:r.recommendedAction,last_modified_by:c}).select().single();if(l)throw l;t(g=>({overallAssessment:{...g.overallAssessment,overallId:d.overall_id,isDirty:!1}}))}t({saveStatus:"saved",lastSaved:new Date}),setTimeout(()=>{t({saveStatus:"idle"})},2e3)}catch(d){console.error("Error saving assessments:",d),t({saveStatus:"error"})}finally{n=!1}},1e3)}})(),getComponentStatus:s=>{const{outcomes:n,componentAssessments:a,participant:o}=i(),u=n[s]||[],r=a[s];if(!r||Object.keys(r.scores).length===0)return"not_started";const c=u.filter(l=>{const g=l.applies_to==="BOTH"||l.applies_to===o?.assessment_role||o?.assessment_role==="BOTH";return l.is_mandatory&&g});return c.filter(l=>r.scores[l.outcome_id]?.bondyScore!==null||r.scores[l.outcome_id]?.binaryScore!==null).length>=c.length?"complete":"in_progress"},reset:()=>t(I)}));function xe({components:t,activeComponentId:i,onSelectComponent:s,getComponentStatus:n}){const a=(r,c)=>{if(c)switch(r){case"complete":return"bg-green-500 text-white";case"in_progress":return"bg-yellow-500 text-white";default:return"bg-redi-coral text-white"}switch(r){case"complete":return"bg-green-100 text-green-700";case"in_progress":return"bg-yellow-100 text-yellow-700";default:return"bg-gray-100 text-gray-600"}},o=r=>{switch(r){case"complete":return e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})});case"in_progress":return e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})});default:return null}},u=r=>{const c=r.split(" ");return c.length<=2?r:r.includes("Airway")?"Airway":r.includes("Electrical")?"Elec Tx":r.includes("CPR")?"CPR/AED":r.includes("Simulation")?"Sim":c.slice(0,2).join(" ")};return e.jsx("div",{className:"overflow-x-auto scrollbar-hide",role:"tablist","aria-label":"Assessment components",children:e.jsx("div",{className:"flex space-x-2 pb-2",children:t.sort((r,c)=>r.component_order-c.component_order).map(r=>{const c=n(r.component_id),d=i===r.component_id;return e.jsxs("button",{role:"tab","aria-selected":d,onClick:()=>s(r.component_id),className:`
                  flex-shrink-0 px-4 py-2 rounded-lg font-medium text-sm
                  flex items-center space-x-2
                  transition-all duration-200
                  ${a(c,d)}
                  ${d?"shadow-md":"hover:shadow-sm"}
                `,children:[o(c),e.jsx("span",{className:"hidden sm:inline",children:r.component_name}),e.jsx("span",{className:"sm:hidden",children:u(r.component_name)})]},r.component_id)})})})}function pe({value:t,onChange:i,disabled:s=!1}){const n=(a,o)=>{if(!o)return"bg-gray-100 text-gray-600 hover:bg-gray-200";switch(a){case"INDEPENDENT":return"bg-green-500 text-white";case"SUPERVISED":return"bg-lime-600 text-white";case"ASSISTED":return"bg-amber-500 text-white";case"MARGINAL":return"bg-orange-500 text-white";case"NOT_OBSERVED":return"bg-gray-500 text-white";default:return"bg-gray-100 text-gray-600"}};return e.jsx("div",{className:"flex space-x-1",children:ce.map(a=>{const o=t===a.score;return e.jsx("button",{type:"button",onClick:()=>!s&&i(a.score),disabled:s,className:`
              w-11 h-11 min-w-[44px] min-h-[44px] rounded-lg font-semibold text-sm
              flex items-center justify-center
              transition-all duration-150
              ${n(a.score,o)}
              ${s?"opacity-50 cursor-not-allowed":"cursor-pointer"}
              ${o?"ring-2 ring-offset-2 ring-redi-teal":""}
            `,title:`${a.label}: ${a.description}`,"aria-label":a.label,children:a.shortLabel},a.score)})})}function ge({outcome:t,bondyScore:i,binaryScore:s,participantRole:n,onBondyChange:a,onBinaryChange:o,disabled:u=!1}){const r=t.applies_to==="BOTH"||t.applies_to===n||n==="BOTH",c=l=>{switch(l){case"TEAM_LEADER":return"bg-redi-navy/10 text-redi-navy";case"TEAM_MEMBER":return"bg-redi-teal/10 text-redi-teal";case"BOTH":return"bg-redi-sky/10 text-redi-sky";default:return"bg-gray-100 text-gray-600"}},d=l=>{switch(l){case"TEAM_LEADER":return"TL";case"TEAM_MEMBER":return"TM";case"BOTH":return"Both"}};return r?e.jsx("div",{className:`
        py-3 px-4 rounded-lg mb-2
        ${t.is_mandatory?"bg-white border border-gray-200":"bg-gray-50 border border-gray-100"}
        ${u?"opacity-60":""}
      `,children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:`
                flex-shrink-0 px-1.5 py-0.5 text-xs font-medium rounded
                ${c(t.applies_to)}
              `,children:d(t.applies_to)}),e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:`text-sm ${t.is_mandatory?"font-medium text-gray-900":"text-gray-600"}`,children:t.outcome_text}),t.is_mandatory&&e.jsx("span",{className:"ml-1 text-red-500 font-bold",title:"Mandatory",children:"*"})]})]})}),e.jsx("div",{className:"flex-shrink-0",children:t.outcome_type==="BONDY_SCALE"?e.jsx(pe,{value:i,onChange:a,disabled:u}):e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{type:"button",onClick:()=>!u&&o("PASS"),disabled:u,className:`
                  px-4 py-2 rounded-lg font-medium text-sm
                  transition-all duration-150
                  ${s==="PASS"?"bg-green-500 text-white ring-2 ring-offset-2 ring-green-400":"bg-gray-100 text-gray-600 hover:bg-gray-200"}
                  ${u?"cursor-not-allowed":"cursor-pointer"}
                `,children:"Pass"}),e.jsx("button",{type:"button",onClick:()=>!u&&o("FAIL"),disabled:u,className:`
                  px-4 py-2 rounded-lg font-medium text-sm
                  transition-all duration-150
                  ${s==="FAIL"?"bg-red-500 text-white ring-2 ring-offset-2 ring-red-400":"bg-gray-100 text-gray-600 hover:bg-gray-200"}
                  ${u?"cursor-not-allowed":"cursor-pointer"}
                `,children:"Fail"})]})})]})}):null}function he({onQuickPass:t,isQuickPassed:i,disabled:s=!1}){const[n,a]=f.useState(!1),o=()=>{s||(a(!0),t(),setTimeout(()=>a(!1),300))};return e.jsxs("button",{type:"button",onClick:o,disabled:s,className:`
        px-4 py-2 rounded-lg font-semibold text-sm
        flex items-center space-x-2
        transition-all duration-200
        ${i?"bg-green-500 text-white":"bg-green-100 text-green-700 hover:bg-green-200"}
        ${s?"opacity-50 cursor-not-allowed":"cursor-pointer"}
        ${n?"scale-105":""}
      `,title:"Mark all mandatory outcomes as Independent",children:[e.jsx("svg",{className:`w-5 h-5 ${n?"animate-bounce":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),e.jsx("span",{children:i?"PASSED":"QUICK PASS"})]})}function R({value:t,onChange:i,placeholder:s="Enter feedback...",label:n,disabled:a=!1}){const[o,u]=f.useState(!1),r=f.useRef(null);return f.useEffect(()=>{if(r.current){r.current.style.height="auto";const c=r.current.scrollHeight;r.current.style.height=`${Math.min(c,o?200:80)}px`}},[t,o]),e.jsxs("div",{className:"w-full",children:[n&&e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:n}),e.jsxs("div",{className:"relative",children:[e.jsx("textarea",{ref:r,value:t,onChange:c=>i(c.target.value),placeholder:s,disabled:a,onFocus:()=>u(!0),onBlur:()=>u(!1),className:`
            w-full px-3 py-2 border border-gray-300 rounded-lg
            focus:ring-2 focus:ring-redi-teal focus:border-transparent
            transition-all duration-200 resize-none
            ${a?"bg-gray-100 cursor-not-allowed":"bg-white"}
          `,style:{minHeight:"44px"}}),t.length>0&&e.jsxs("div",{className:"absolute bottom-2 right-2 text-xs text-gray-400",children:[t.length," chars"]})]})]})}function fe({value:t,onChange:i,disabled:s=!1}){return e.jsx("div",{className:"flex space-x-2",children:le.map(n=>{const a=t===n.value;return e.jsx("button",{type:"button",onClick:()=>!s&&i(n.value),disabled:s,className:`
              w-12 h-12 rounded-lg text-2xl
              flex items-center justify-center
              transition-all duration-150
              ${a?"bg-redi-teal/20 ring-2 ring-redi-teal ring-offset-2":"bg-gray-100 hover:bg-gray-200"}
              ${s?"opacity-50 cursor-not-allowed":"cursor-pointer"}
            `,title:n.label,"aria-label":n.label,children:e.jsx("span",{"aria-hidden":"true",children:n.emoji})},n.value)})})}function $({status:t,lastSaved:i}){const s=()=>{switch(t){case"saving":return e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"w-4 h-4 animate-spin text-redi-teal",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),e.jsx("span",{className:"text-redi-teal",children:"Saving..."})]});case"saved":return e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-4 h-4 text-green-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),e.jsxs("span",{className:"text-green-600",children:["Saved ",i&&`at ${i.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}`]})]});case"error":return e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-4 h-4 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("span",{className:"text-red-600",children:"Save failed"})]});default:return e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-4 h-4 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"})}),e.jsx("span",{className:"text-gray-500",children:"Auto-save enabled"})]})}};return e.jsx("div",{className:"flex items-center space-x-1.5 text-xs",role:"status","aria-live":"polite",children:s()})}function _e(){const{courseId:t,participantId:i}=ae(),{assessor:s}=oe(),n=ie(),[a,o]=f.useState(!0),[u,r]=f.useState(""),{participant:c,components:d,outcomes:l,componentAssessments:g,overallAssessment:p,activeComponentId:x,saveStatus:h,lastSaved:j,setParticipant:N,setComponents:S,setOutcomes:w,setActiveComponent:F,loadAssessments:v,setBondyScore:H,setBinaryScore:U,applyQuickPass:Q,setComponentFeedback:q,setOverallFeedback:W,setEngagementScore:z,setTeamLeaderOutcome:G,setTeamMemberOutcome:V,setRecommendedAction:Y,getComponentStatus:J,reset:A}=ue(),K=f.useMemo(()=>i?[i]:[],[i]),{connectionStatus:k,activeAssessors:X,trackPresence:E}=de({courseId:t,participantIds:K,onAssessmentChange:f.useCallback(()=>{v()},[v]),onScoreChange:f.useCallback(()=>{v()},[v])});f.useEffect(()=>{i&&x&&E(i,x)},[i,x,E]);const C=f.useCallback(async()=>{o(!0),r("");try{const{data:m,error:y}=await b.from("courses").select("*").eq("course_id",t).single();if(y)throw y;const{data:te,error:T}=await b.from("participants").select("*").eq("participant_id",i).single();if(T)throw T;N(te);const{data:L,error:D}=await b.from("template_components").select("*").eq("template_id",m.template_id).order("component_order",{ascending:!0});if(D)throw D;S(L);for(const M of L){const{data:re,error:B}=await b.from("template_outcomes").select("*").eq("component_id",M.component_id).order("outcome_order",{ascending:!0});if(B)throw B;w(M.component_id,re)}await v()}catch(m){console.error("Error loading data:",m),r("Failed to load assessment data. Please try again.")}finally{o(!1)}},[t,i,N,S,w,v]);f.useEffect(()=>(t&&i&&C(),()=>{A()}),[t,i,C,A]);const O=()=>{n(`/course/${t}/participants`)},Z=x?l[x]||[]:[],_=x?g[x]:null,ee=m=>{switch(m){case"TEAM_LEADER":return"bg-redi-navy/10 text-redi-navy";case"TEAM_MEMBER":return"bg-redi-teal/10 text-redi-teal";case"BOTH":return"bg-redi-sky/10 text-redi-sky";default:return"bg-gray-100 text-gray-800"}},se=m=>m.split("_").map(y=>y.charAt(0)+y.slice(1).toLowerCase()).join(" ");return a?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",role:"status","aria-label":"Loading",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-redi-teal mx-auto","aria-hidden":"true"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Loading assessment..."})]})}):u?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6 max-w-md w-full",children:[e.jsx("div",{className:"text-red-500 mb-4",children:e.jsx("svg",{className:"w-12 h-12 mx-auto",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsx("h2",{className:"text-xl font-bold text-center text-redi-navy mb-2",children:"Error"}),e.jsx("p",{className:"text-gray-600 text-center mb-4",children:u}),e.jsx("button",{onClick:O,className:"w-full bg-redi-coral text-white py-2 px-4 rounded-lg hover:bg-redi-coral-dark",children:"Go Back"})]})}):e.jsxs("div",{className:"min-h-screen bg-gray-50 pb-24",children:[e.jsx("header",{className:"bg-white shadow-sm border-b-2 border-redi-coral sticky top-0 z-10",children:e.jsx("div",{className:"max-w-4xl mx-auto px-4 py-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("button",{onClick:O,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors","aria-label":"Go back",children:e.jsx("svg",{className:"h-5 w-5 text-gray-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("h1",{className:"text-lg font-bold text-redi-navy truncate",children:c?.candidate_name}),e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-600",children:[e.jsx("span",{className:`px-2 py-0.5 text-xs font-medium rounded-full ${ee(c?.assessment_role||"")}`,children:se(c?.assessment_role||"")}),e.jsx("span",{className:"hidden sm:inline",children:c?.designation}),e.jsx("span",{className:"hidden sm:inline",children:"â€¢"}),e.jsx("span",{className:"hidden sm:inline",children:c?.work_area})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(P,{status:k}),e.jsx(me,{assessors:X,currentParticipantId:i,currentComponentId:x||void 0}),e.jsx($,{status:h,lastSaved:j})]})]})})}),e.jsx("div",{className:"bg-white border-b border-gray-200 sticky top-[72px] z-10",children:e.jsx("div",{className:"max-w-4xl mx-auto px-4 py-2",children:e.jsx(xe,{components:d,activeComponentId:x,onSelectComponent:F,getComponentStatus:J})})}),e.jsxs("main",{className:"max-w-4xl mx-auto px-4 py-4",children:[x&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-redi-navy",children:d.find(m=>m.component_id===x)?.component_name}),e.jsx(he,{onQuickPass:()=>Q(x),isQuickPassed:_?.isQuickPassed||!1})]}),e.jsx("div",{className:"mb-4 p-3 bg-gray-100 rounded-lg",children:e.jsxs("div",{className:"flex flex-wrap gap-3 text-xs text-gray-600",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-6 h-6 rounded bg-green-500 text-white flex items-center justify-center font-semibold",children:"I"}),"Independent"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-6 h-6 rounded bg-lime-600 text-white flex items-center justify-center font-semibold",children:"S"}),"Supervised"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-6 h-6 rounded bg-amber-500 text-white flex items-center justify-center font-semibold",children:"A"}),"Assisted"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-6 h-6 rounded bg-orange-500 text-white flex items-center justify-center font-semibold",children:"M"}),"Marginal"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-6 h-6 rounded bg-gray-500 text-white flex items-center justify-center font-semibold",children:"N"}),"Not Observed"]})]})}),e.jsx("div",{className:"space-y-2 mb-6",children:Z.sort((m,y)=>m.outcome_order-y.outcome_order).map(m=>e.jsx(ge,{outcome:m,bondyScore:_?.scores[m.outcome_id]?.bondyScore||null,binaryScore:_?.scores[m.outcome_id]?.binaryScore||null,participantRole:c?.assessment_role||"TEAM_MEMBER",onBondyChange:y=>H(x,m.outcome_id,y),onBinaryChange:y=>U(x,m.outcome_id,y)},m.outcome_id))}),e.jsx("div",{className:"mb-6",children:e.jsx(R,{value:_?.feedback||"",onChange:m=>q(x,m),label:"Component Feedback",placeholder:"Enter feedback for this component..."})})]}),e.jsxs("div",{className:"mt-8 pt-6 border-t border-gray-200",children:[e.jsx("h2",{className:"text-lg font-semibold text-redi-navy mb-4",children:"Overall Assessment"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Engagement Level"}),e.jsx(fe,{value:p.engagementScore,onChange:z})]}),(c?.assessment_role==="TEAM_LEADER"||c?.assessment_role==="BOTH")&&e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Team Leader Outcome"}),e.jsx("div",{className:"flex gap-3",children:["PASS","UNSUCCESSFUL_ATTEMPT"].map(m=>e.jsx("button",{type:"button",onClick:()=>G(p.teamLeaderOutcome===m?null:m),className:`flex-1 py-2 px-4 rounded-lg border-2 text-sm font-medium transition-colors ${p.teamLeaderOutcome===m?m==="PASS"?"border-green-500 bg-green-50 text-green-700":"border-red-500 bg-red-50 text-red-700":"border-gray-300 bg-white text-gray-600 hover:border-gray-400"}`,children:m==="PASS"?"Pass":"Unsuccessful Attempt"},m))})]}),(c?.assessment_role==="TEAM_MEMBER"||c?.assessment_role==="BOTH")&&e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Team Member Outcome"}),e.jsx("div",{className:"flex gap-3",children:["PASS","UNSUCCESSFUL_ATTEMPT"].map(m=>e.jsx("button",{type:"button",onClick:()=>V(p.teamMemberOutcome===m?null:m),className:`flex-1 py-2 px-4 rounded-lg border-2 text-sm font-medium transition-colors ${p.teamMemberOutcome===m?m==="PASS"?"border-green-500 bg-green-50 text-green-700":"border-red-500 bg-red-50 text-red-700":"border-gray-300 bg-white text-gray-600 hover:border-gray-400"}`,children:m==="PASS"?"Pass":"Unsuccessful Attempt"},m))})]}),(p.teamLeaderOutcome==="UNSUCCESSFUL_ATTEMPT"||p.teamMemberOutcome==="UNSUCCESSFUL_ATTEMPT")&&e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Recommended Action"}),e.jsxs("select",{value:p.recommendedAction||"",onChange:m=>Y(m.target.value?m.target.value:null),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-redi-teal focus:border-transparent",children:[e.jsx("option",{value:"",children:"Select recommended action..."}),e.jsx("option",{value:"RESTART_LEARNING",children:"Restart Learning"}),e.jsx("option",{value:"REATTEMPT_COURSE",children:"Reattempt Course"}),e.jsx("option",{value:"REASSESSMENT_ONLY",children:"Reassessment Only"}),e.jsx("option",{value:"REFER_EDUCATOR",children:"Refer to Educator"})]})]}),e.jsx(R,{value:p.feedback,onChange:W,label:"Overall Feedback",placeholder:"Enter overall feedback for this participant..."})]})]}),e.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 p-4 sm:hidden",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(P,{status:k}),e.jsx("span",{className:"text-sm text-gray-600",children:s?.name})]}),e.jsx($,{status:h,lastSaved:j})]})})]})}export{_e as default};
